<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Disc Dash VR â€” Throwing Game</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-physics-system@v4.2.2/dist/aframe-physics-system.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@700;900&family=Exo+2:wght@400;700&display=swap');

    body { margin: 0; overflow: hidden; background: #000; }

    #hud-overlay {
      position: fixed;
      top: 0; left: 0; right: 0;
      z-index: 999;
      pointer-events: none;
      display: flex;
      justify-content: center;
      padding: 20px;
    }

    #score-panel {
      background: linear-gradient(135deg, rgba(0,20,40,0.85), rgba(0,60,80,0.7));
      border: 2px solid rgba(0,220,255,0.5);
      border-radius: 16px;
      padding: 12px 32px;
      display: flex;
      gap: 40px;
      align-items: center;
      backdrop-filter: blur(12px);
      box-shadow: 0 0 30px rgba(0,180,255,0.2), inset 0 0 20px rgba(0,180,255,0.05);
    }

    .stat {
      text-align: center;
    }

    .stat-label {
      font-family: 'Exo 2', sans-serif;
      font-size: 11px;
      color: rgba(0,220,255,0.7);
      text-transform: uppercase;
      letter-spacing: 3px;
    }

    .stat-value {
      font-family: 'Orbitron', sans-serif;
      font-size: 32px;
      font-weight: 900;
      color: #00e5ff;
      text-shadow: 0 0 20px rgba(0,229,255,0.6);
    }

    #message {
      position: fixed;
      bottom: 80px;
      left: 50%; transform: translateX(-50%);
      z-index: 999;
      font-family: 'Orbitron', sans-serif;
      font-size: 18px;
      color: #00e5ff;
      background: rgba(0,20,40,0.8);
      border: 1px solid rgba(0,220,255,0.4);
      padding: 10px 24px;
      border-radius: 12px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s;
      text-shadow: 0 0 10px rgba(0,229,255,0.5);
    }

    #message.visible { opacity: 1; }

    #vr-button-hint {
      position: fixed;
      bottom: 20px;
      left: 50%; transform: translateX(-50%);
      z-index: 999;
      font-family: 'Exo 2', sans-serif;
      font-size: 14px;
      color: rgba(0,220,255,0.8);
      pointer-events: none;
    }
  </style>
</head>
<body>

<div id="hud-overlay">
  <div id="score-panel">
    <div class="stat">
      <div class="stat-label">Score</div>
      <div class="stat-value" id="score-val">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Streak</div>
      <div class="stat-value" id="streak-val">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Best</div>
      <div class="stat-value" id="best-val">0</div>
    </div>
    <div class="stat">
      <div class="stat-label">Discs</div>
      <div class="stat-value" id="disc-val">âˆž</div>
    </div>
  </div>
</div>

<div id="message"></div>
<div id="vr-button-hint">ðŸŽ® Click VR button to enter Meta Quest â€¢ Mouse: click targets to score</div>

<a-scene
  vr-mode-ui="enabled: true"
  renderer="antialias: true; colorManagement: true; sortObjects: true"
  fog="type: exponential; color: #0a1628; density: 0.015"
  game-manager
>
  <!-- Assets -->
  <a-assets>
    <a-mixin id="target-ring" geometry="primitive: torus; radius: 0.6; radiusTabular: 0.05; segmentsRadial: 24; segmentsTubular: 36"></a-mixin>
  </a-assets>

  <!-- Sky & Environment -->
  <a-sky color="#060d1a"></a-sky>

  <!-- Ambient star field -->
  <a-entity id="stars" star-field></a-entity>

  <!-- Ground -->
  <a-plane
    position="0 0 0"
    rotation="-90 0 0"
    width="100" height="100"
    material="color: #0a1a2e; roughness: 0.9; metalness: 0.1"
  ></a-plane>

  <!-- Glowing grid lines on ground -->
  <a-entity id="grid-lines" ground-grid></a-entity>

  <!-- Lighting -->
  <a-light type="ambient" color="#1a3050" intensity="0.4"></a-light>
  <a-light type="directional" color="#4488cc" intensity="0.6" position="5 10 5"></a-light>
  <a-light type="point" color="#00e5ff" intensity="0.8" position="0 8 -10" distance="30"></a-light>
  <a-light type="point" color="#ff006e" intensity="0.5" position="-8 5 -15" distance="25"></a-light>
  <a-light type="point" color="#7b2fff" intensity="0.5" position="8 5 -15" distance="25"></a-light>

  <!-- Arena Pillars -->
  <a-entity class="pillar" position="-8 0 -5">
    <a-cylinder height="8" radius="0.3" material="color: #0d2240; emissive: #003366; emissiveIntensity: 0.3" position="0 4 0"></a-cylinder>
    <a-sphere radius="0.4" material="color: #00e5ff; emissive: #00e5ff; emissiveIntensity: 0.8" position="0 8.2 0" pulse-glow></a-sphere>
  </a-entity>
  <a-entity class="pillar" position="8 0 -5">
    <a-cylinder height="8" radius="0.3" material="color: #0d2240; emissive: #003366; emissiveIntensity: 0.3" position="0 4 0"></a-cylinder>
    <a-sphere radius="0.4" material="color: #00e5ff; emissive: #00e5ff; emissiveIntensity: 0.8" position="0 8.2 0" pulse-glow></a-sphere>
  </a-entity>
  <a-entity class="pillar" position="-12 0 -20">
    <a-cylinder height="10" radius="0.4" material="color: #0d2240; emissive: #1a0040; emissiveIntensity: 0.3" position="0 5 0"></a-cylinder>
    <a-sphere radius="0.5" material="color: #7b2fff; emissive: #7b2fff; emissiveIntensity: 0.8" position="0 10.3 0" pulse-glow></a-sphere>
  </a-entity>
  <a-entity class="pillar" position="12 0 -20">
    <a-cylinder height="10" radius="0.4" material="color: #0d2240; emissive: #1a0040; emissiveIntensity: 0.3" position="0 5 0"></a-cylinder>
    <a-sphere radius="0.5" material="color: #7b2fff; emissive: #7b2fff; emissiveIntensity: 0.8" position="0 10.3 0" pulse-glow></a-sphere>
  </a-entity>

  <!-- Target Zones -->
  <a-entity id="targets-container"></a-entity>

  <!-- Disc in hand (VR) -->
  <a-entity id="disc-in-hand" visible="false">
    <a-cylinder
      radius="0.15" height="0.025"
      material="color: #00e5ff; emissive: #00e5ff; emissiveIntensity: 0.6; metalness: 0.8; roughness: 0.2"
      rotation="0 0 0"
    >
      <a-torus radius="0.12" radius-tubular="0.01" material="color: #ffffff; emissive: #00e5ff; emissiveIntensity: 1; opacity: 0.6; transparent: true"></a-torus>
    </a-cylinder>
  </a-entity>

  <!-- Camera Rig -->
  <a-entity id="rig" position="0 0 5">
    <a-camera
      look-controls="pointerLockEnabled: false"
      wasd-controls="enabled: true; acceleration: 20"
      position="0 1.6 0"
      cursor="rayOrigin: mouse; fuse: false"
      raycaster="objects: .target-hit-zone; far: 50"
    >
      <!-- Crosshair for non-VR -->
      <a-ring
        radius-inner="0.003" radius-outer="0.005"
        material="color: #00e5ff; opacity: 0.6; transparent: true"
        position="0 0 -0.5"
      ></a-ring>
    </a-camera>

    <!-- VR Controllers -->
    <a-entity
      id="left-hand"
      laser-controls="hand: left"
      raycaster="objects: .target-hit-zone; far: 50"
    ></a-entity>
    <a-entity
      id="right-hand"
      laser-controls="hand: right"
      raycaster="objects: .target-hit-zone; far: 50"
      disc-thrower
    ></a-entity>
  </a-entity>

</a-scene>

<script>
// â”€â”€â”€ Pulse Glow Component â”€â”€â”€
AFRAME.registerComponent('pulse-glow', {
  tick: function(t) {
    const s = 0.8 + Math.sin(t / 600) * 0.3;
    this.el.setAttribute('material', 'emissiveIntensity', s);
  }
});

// â”€â”€â”€ Star Field Component â”€â”€â”€
AFRAME.registerComponent('star-field', {
  init: function() {
    const geo = new THREE.BufferGeometry();
    const count = 2000;
    const positions = new Float32Array(count * 3);
    const colors = new Float32Array(count * 3);
    for (let i = 0; i < count; i++) {
      positions[i*3]   = (Math.random() - 0.5) * 200;
      positions[i*3+1] = Math.random() * 80 + 5;
      positions[i*3+2] = (Math.random() - 0.5) * 200;
      const c = new THREE.Color().setHSL(0.55 + Math.random()*0.15, 0.6, 0.5 + Math.random()*0.5);
      colors[i*3] = c.r; colors[i*3+1] = c.g; colors[i*3+2] = c.b;
    }
    geo.setAttribute('position', new THREE.BufferAttribute(positions, 3));
    geo.setAttribute('color', new THREE.BufferAttribute(colors, 3));
    const mat = new THREE.PointsMaterial({ size: 0.3, vertexColors: true, transparent: true, opacity: 0.8 });
    this.el.setObject3D('mesh', new THREE.Points(geo, mat));
  }
});

// â”€â”€â”€ Ground Grid Component â”€â”€â”€
AFRAME.registerComponent('ground-grid', {
  init: function() {
    const group = new THREE.Group();
    const mat = new THREE.LineBasicMaterial({ color: 0x00e5ff, transparent: true, opacity: 0.08 });
    for (let i = -50; i <= 50; i += 2) {
      const geoH = new THREE.BufferGeometry().setFromPoints([
        new THREE.Vector3(-50, 0.01, i), new THREE.Vector3(50, 0.01, i)
      ]);
      const geoV = new THREE.BufferGeometry().setFromPoints([
        new THREE.Vector3(i, 0.01, -50), new THREE.Vector3(i, 0.01, 50)
      ]);
      group.add(new THREE.Line(geoH, mat));
      group.add(new THREE.Line(geoV, mat));
    }
    this.el.setObject3D('mesh', group);
  }
});

// â”€â”€â”€ Game Manager â”€â”€â”€
AFRAME.registerComponent('game-manager', {
  init: function() {
    this.score = 0;
    this.streak = 0;
    this.best = 0;
    this.targets = [];
    this.container = document.getElementById('targets-container');

    // Spawn initial targets
    this.spawnTargets(5);

    // Listen for hits from mouse clicks
    const cam = this.el.querySelector('a-camera');
    cam.addEventListener('click', (e) => {
      if (e.detail && e.detail.intersectedEl) {
        this.handleHit(e.detail.intersectedEl);
      }
    });

    // Listen for VR controller clicks
    ['left-hand', 'right-hand'].forEach(id => {
      const hand = document.getElementById(id);
      hand.addEventListener('triggerdown', () => {
        const raycaster = hand.components.raycaster;
        if (raycaster) {
          const intersections = raycaster.intersections;
          if (intersections.length > 0) {
            this.handleHit(intersections[0].object.el);
          }
        }
      });
    });
  },

  handleHit: function(targetEl) {
    if (!targetEl || !targetEl.classList.contains('target-hit-zone')) return;

    const parentTarget = targetEl.closest('[target-entity]') || targetEl.parentEl;
    if (!parentTarget) return;

    const points = parseInt(parentTarget.getAttribute('data-points') || '10');
    const multiplier = Math.max(1, this.streak);
    const earned = points * Math.min(multiplier, 5);

    this.score += earned;
    this.streak++;
    if (this.score > this.best) this.best = this.score;

    this.updateHUD();
    this.showMessage(`+${earned}${multiplier > 1 ? ' x'+Math.min(multiplier,5) : ''}`, earned >= 50 ? '#ff006e' : '#00e5ff');

    // Explosion effect
    this.spawnExplosion(parentTarget.getAttribute('position'));

    // Remove & respawn
    parentTarget.parentEl.removeChild(parentTarget);
    setTimeout(() => this.spawnTargets(1), 800);
  },

  updateHUD: function() {
    document.getElementById('score-val').textContent = this.score;
    document.getElementById('streak-val').textContent = this.streak;
    document.getElementById('best-val').textContent = this.best;
  },

  showMessage: function(text, color) {
    const msg = document.getElementById('message');
    msg.textContent = text;
    msg.style.color = color || '#00e5ff';
    msg.classList.add('visible');
    clearTimeout(this._msgTimeout);
    this._msgTimeout = setTimeout(() => msg.classList.remove('visible'), 1200);
  },

  spawnTargets: function(count) {
    for (let i = 0; i < count; i++) {
      const x = (Math.random() - 0.5) * 16;
      const y = 1.5 + Math.random() * 5;
      const z = -8 - Math.random() * 18;
      const tier = Math.random();

      let color, emissive, points, radius;
      if (tier > 0.85) {
        // Gold target â€” small, high points
        color = '#ffaa00'; emissive = '#ff6600'; points = 50; radius = 0.35;
      } else if (tier > 0.55) {
        // Pink target â€” medium
        color = '#ff006e'; emissive = '#ff006e'; points = 25; radius = 0.5;
      } else {
        // Cyan target â€” standard
        color = '#00e5ff'; emissive = '#00e5ff'; points = 10; radius = 0.7;
      }

      const target = document.createElement('a-entity');
      target.setAttribute('position', `${x} ${y} ${z}`);
      target.setAttribute('target-entity', '');
      target.setAttribute('data-points', points);
      target.setAttribute('target-float', `speed: ${0.3 + Math.random() * 0.7}; amplitude: ${0.3 + Math.random() * 0.8}`);

      // Outer ring
      const ring = document.createElement('a-torus');
      ring.setAttribute('radius', radius);
      ring.setAttribute('radius-tubular', 0.04);
      ring.setAttribute('segments-radial', 24);
      ring.setAttribute('segments-tubular', 48);
      ring.setAttribute('material', `color: ${color}; emissive: ${emissive}; emissiveIntensity: 0.5; metalness: 0.6; roughness: 0.3`);
      ring.setAttribute('rotation', `${Math.random()*20-10} ${Math.random()*360} 0`);
      ring.classList.add('target-hit-zone');
      target.appendChild(ring);

      // Inner disc (hit zone)
      const disc = document.createElement('a-circle');
      disc.setAttribute('radius', radius * 0.85);
      disc.setAttribute('material', `color: ${color}; emissive: ${emissive}; emissiveIntensity: 0.3; opacity: 0.25; transparent: true; side: double`);
      disc.setAttribute('rotation', ring.getAttribute('rotation'));
      disc.classList.add('target-hit-zone');
      target.appendChild(disc);

      // Center bullseye
      const center = document.createElement('a-sphere');
      center.setAttribute('radius', radius * 0.12);
      center.setAttribute('material', `color: #ffffff; emissive: ${color}; emissiveIntensity: 1`);
      center.classList.add('target-hit-zone');
      target.appendChild(center);

      // Point light
      const light = document.createElement('a-light');
      light.setAttribute('type', 'point');
      light.setAttribute('color', color);
      light.setAttribute('intensity', '0.3');
      light.setAttribute('distance', '5');
      target.appendChild(light);

      this.container.appendChild(target);
    }
  },

  spawnExplosion: function(posStr) {
    const pos = AFRAME.utils.coordinates.parse(posStr);
    const count = 20;
    for (let i = 0; i < count; i++) {
      const particle = document.createElement('a-sphere');
      const angle = Math.random() * Math.PI * 2;
      const elevation = (Math.random() - 0.5) * Math.PI;
      const speed = 1 + Math.random() * 3;
      const dx = Math.cos(angle) * Math.cos(elevation) * speed;
      const dy = Math.sin(elevation) * speed + 1;
      const dz = Math.sin(angle) * Math.cos(elevation) * speed;

      const colors = ['#00e5ff', '#ff006e', '#ffaa00', '#7b2fff', '#ffffff'];
      const c = colors[Math.floor(Math.random() * colors.length)];

      particle.setAttribute('radius', 0.03 + Math.random() * 0.06);
      particle.setAttribute('position', posStr);
      particle.setAttribute('material', `color: ${c}; emissive: ${c}; emissiveIntensity: 1`);
      particle.setAttribute('particle-fly', `dx: ${dx}; dy: ${dy}; dz: ${dz}`);
      this.el.appendChild(particle);
    }
  }
});

// â”€â”€â”€ Target Float Animation â”€â”€â”€
AFRAME.registerComponent('target-float', {
  schema: {
    speed: { type: 'number', default: 0.5 },
    amplitude: { type: 'number', default: 0.5 }
  },
  init: function() {
    this.startPos = this.el.getAttribute('position');
    this.offset = Math.random() * Math.PI * 2;
    this.rotSpeed = (Math.random() - 0.5) * 30;
    this.driftX = (Math.random() - 0.5) * 0.3;
  },
  tick: function(t) {
    const pos = AFRAME.utils.coordinates.parse(this.startPos);
    const time = t / 1000;
    pos.y += Math.sin(time * this.data.speed + this.offset) * this.data.amplitude;
    pos.x += Math.sin(time * this.data.speed * 0.7 + this.offset) * this.driftX;
    this.el.setAttribute('position', pos);

    // Slow rotation
    const rot = this.el.getAttribute('rotation') || {x:0,y:0,z:0};
    rot.y += this.rotSpeed * 0.016;
    this.el.setAttribute('rotation', rot);
  }
});

// â”€â”€â”€ Particle Fly (Explosion) â”€â”€â”€
AFRAME.registerComponent('particle-fly', {
  schema: {
    dx: { type: 'number', default: 0 },
    dy: { type: 'number', default: 1 },
    dz: { type: 'number', default: 0 }
  },
  init: function() {
    this.vel = { x: this.data.dx, y: this.data.dy, z: this.data.dz };
    this.life = 0;
    this.maxLife = 0.8 + Math.random() * 0.5;
  },
  tick: function(t, dt) {
    const s = dt / 1000;
    this.life += s;
    if (this.life > this.maxLife) {
      this.el.parentEl.removeChild(this.el);
      return;
    }
    this.vel.y -= 4 * s; // gravity
    const pos = this.el.getAttribute('position');
    pos.x += this.vel.x * s;
    pos.y += this.vel.y * s;
    pos.z += this.vel.z * s;
    this.el.setAttribute('position', pos);
    const opacity = 1 - (this.life / this.maxLife);
    this.el.setAttribute('material', 'opacity', opacity);
    const scale = opacity * 1.5;
    this.el.setAttribute('scale', `${scale} ${scale} ${scale}`);
  }
});

// â”€â”€â”€ Disc Thrower (VR Controller) â”€â”€â”€
AFRAME.registerComponent('disc-thrower', {
  init: function() {
    this.el.addEventListener('gripdown', () => {
      const disc = document.getElementById('disc-in-hand');
      disc.setAttribute('visible', true);
      // Attach to hand
      this.el.appendChild(disc);
    });

    this.el.addEventListener('gripup', () => {
      const disc = document.getElementById('disc-in-hand');
      disc.setAttribute('visible', false);
    });
  }
});

// â”€â”€â”€ Miss tracker (clicking empty space resets streak) â”€â”€â”€
document.addEventListener('DOMContentLoaded', () => {
  const scene = document.querySelector('a-scene');
  scene.addEventListener('loaded', () => {
    const cam = scene.querySelector('a-camera');
    cam.addEventListener('click', (e) => {
      if (!e.detail || !e.detail.intersectedEl) {
        const gm = scene.components['game-manager'];
        if (gm && gm.streak > 0) {
          gm.streak = 0;
          gm.updateHUD();
          gm.showMessage('Miss! Streak reset', '#ff3366');
        }
      }
    });
  });
});
</script>

</body>
</html>
